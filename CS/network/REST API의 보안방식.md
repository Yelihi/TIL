## REST API 보안

<p>근래 대부분의 서비스는 API 를 기반으로 통신한다. 이에 따라 API 보안 역시 중요하다.</p>

### 인증(Authentication)

- 인증은 누가 서비스를 사용하는지 확인하는 절차
- 즉 아이디와 패스워드를 기입하여 사용자를 확인하게 된다.
- API 역시 마찬가지인데, API 를 호출하는 대상이 서버인지 사용자가 되었던지 결국 누구인지 확인하는 절차가 필요하다.

### 인가(Authorization)

- 인가는 해당 리소스에 대해 사용자가 그 리소스를 사용한 권리가 있는지 확인하는 체크 과정
- 로그인한 사람만(인증된 사람) 프로필 페이지를 사용할 수 있거나, 주문을 할 수 있는 등

### 네트워크 레벨 암호화

- 인증과 인가 과정이 끝나서 API 를 호출하게 되면, 네트워크를 통해서 데이터가 오가는데 이때 해커가 중간에서 이 통신을 감청할 수 없게 할 필요가 있다.
- 이에 네트워크 프로토콜단에서 암호화를 처리할 수 있는데, 이를 네트워크 암호화라고 한다. HTTP 기반에서의 네트워크 암호화는 일반적으로 HTTPS 기반의 프로토콜을 사용한다.

### 인증(Authentication) 방식의 종류

<p>API에 대한 인증 방식은 여러가지 방식이 있고, 보안수준과 구현수준이 다르기 때문에 구현하고자 하는 서비스의 특성을 살려서 적절한 API 인증 방식을 선택하여야 한다.</p>

> **API 키 방식**

- API key : 특정 사용자만 알수 있는 일종의 문자열.
- API를 호출하고자 할 때, 개발자는 API 제공사의 포탈 페이지에서 API 키를 발급 받고 API를 호출 할 때 API 키를 메세지 안에 넣는다. 서버는 메시지 안 API 키를 읽어서 누가 호출한 것인지 파악한다.
- 모든 클라이언트가 같은 key 를 공유하기에, 한번 key 가 노출되면 모든 API가 보안에서 취약해지기 때문에 높은 보안 인증이 필요할 때는 하지 않는다.

> **API 토큰**

- 사용자의 아이디와 비밀번호를 인증한 다음, 서버에서 일정 기간 유효한 토큰을 발급하는 방식이다.
- 매번 API 호출 시 아이디와 비밀번호를 보내지 않고 API 토큰을 사용하는 이유는 사용자와 비밀번호는 주기적으로 바뀔 수 있기 때문이고, 매번 네트워크를 통해서 사용자 ID와 비밀번호를 보내는 것은 보안상 계정 정보를 탈취당할 가능성이 크기 때문.

## Claim 기반은 JWT 방식

> **Claim 기반 토큰의 개념**

- 보통 token 의 경우 특별한 정보를 가지고 있지 않는다.
- 하지만 JWT는 Claim 기반이라는 방식을 사용하는데, Claim 은 사용자에 대한 프로퍼티나 속성을 말한다.

```js
{
  "id: "won",
  "role": "admin",
  "company": "pepsi",
}
```

- 이 토큰을 이용해서 요청을 받는 서버나 서비스 입장에서는 이 서비스를 호출한 사용자에 대한 추가 정보는 이미 토큰 안에 다 들어가 있기 때문에, 다른 곳에서 가져올 필요가 없다는 장점이 있다.
- 결과적으로 토큰을 생성하는 단계에서는 생성된 토큰을 별도로 서버에서 유지할 필요가 없다. 서버 입장에서는 API 요청을 검증하기 위해 토큰을 가지고 사용자 정보를 별도로 계정 시스템 등에서 조회할 필요가 없다는 것.
- JWT 는 JSON Claim을 Base 64로 인코딩하여 HTTP 헤더에 쉽게 넣을 수 있다.

> **JWT 의 단점**

- Claim 에 넣는 데이터가 많아질수록 토큰 길이가 길어진다. 헤더에 붙여서 보내기 때문에 길이가 길어진다는 것은 네트워크 대역폭 낭비가 심하다는 의미.
- 한번 발급된 토큰은 수정하거나 폐기가 불가능하다. 그렇기 때문에 만료 시간을 꼭 명시하고 중간마다 토큰을 재 발행하여야 한다.
- 기본적으로 JWT 는 Claim 에 대한 정보를 암호화 하지는 않는다.
