## 상태코드

<p>클라이언트가 보낸 요청의 처리 상태를 응답에서 알려주는 기능</p>

- 1xx (informational): 요청이 수신되어 처리중
- 2xx (Successful): 요청 정상 처리
- 3xx (Redirection): 요청을 완료하려면 추가 행동이 필요
- 4xx (Client Error): 클라이언트 오류, 잘못된 문법 등으로 서버가 요청을 수행할 수 없음
- 5xx (Server Error): 서버 오류, 서버가 정상 요청을 처리하지 못함.

<p>만약에 모르는 상태 코드가 나타난다면 어떻게 처리해야할까. 예를 들어 299 가 왔다고 한다면, 그냥 200 으로 처리하는게 맞다.즉, 상위 상태코드로 해석해서 처리하면 된다.</p>

### 1XX(Informational): 요청이 수신되어 처리중

- 거의 사용하지 않음

### 2XX(Successful): 클라이언트의 요청을 성공적으로 처리

- 200 Ok : 성공적으로 처리
- 201 Created
  - 주로 Post인 경우로 서버에서 신규 리소스 생성 -> 응답 시 리소스를 헤더에 넣어서 응답
- 202 Accepted : 요청이 접수되었지만 처리가 잘 안됨(잘 사용하지않음)
- 204 No Content : 성공적으로 응답했지만 응답 페이로드 본문에 보낼 데이터가 없는경우
  - 문서 저장 버튼을 눌러(요청) 포스팅할 때, 서버에서 성공 응답을 보내도 굳이 본문 내용을 보낼 필요는 없다.

### 3XX(Redirection): 요청을 완료하기 위해 유저 에이전트의 추가 조치 필요

<p>리다이렉션이란 웹 브라우저는 3xx 응답 결과에 location 이 있다면 location 위치로 자동으로 이동하는 것을 의미한다.</p><br />

<p>예를 들어서 /event 라는 페이지를 쓰지 않고 /new-event 라는 url 을 사용한다고 가정하자. 사람들은 이 변경사항에 대해 모를 수도 있고, 그래서 기존 url 로 접근할 수 있다. 이럴 경우 서버는 이전 url 의 접근을 받은 다음, 응답으로 브라우저에게 300대 와 location 을 보내게 된다. 브라우저는 이를 읽고 파악하여 새로 보낸 url 로 다시 요청을 하게 된다.</p>

- 영구 리다이렉션 - 특정 리소스의 URI가 영구적으로 이동 (ex. /members -> /users)
- 일시 리다이렉션 - 일시적인 변경 (예를 들면 주문 완료 후 주문 내역으로 화면 이동)
- 특수 리다이렉션 - 요청을 보냈을 때, 기존 캐시를 활용해도 된다 파악될 때 다시 캐시를 사용하게끔 하는것

<strong>영구 리다이렉션</strong>
<br />

- 리소스의 URI가 영구적으로 이동
- 원래의 URL을 사용하지 않는다. 검색 엔진 등에서도 변경 인지
- 301 Moved Permanently
  - 리다이렉트시 요청 메서드가 GET 으로 변하고, 본문이 제거될 수 있음
- 308 Permanent Redirect
  - 리다이렉트시 요청 메서드와 본문 유지(처음 POST 라면 이를 유지)

<p>예를 들어서 등록을 원해서 POST 를 통해 바디에 내용을 적어서 요청했을 때, 이 페이지가 다른 주소로 업데이트 된 부분이라면, 응답으로 301 을 보내게 되고, 브라우저는 이를 통해 새로운 주소로 GET 요청을 보내게 된다. 이 요청을 받은 서버는 그에 대해 새로운 이벤트 페이지를 보여주게 된다. 결국 유저는 다시 작성을 해야한다. 거의 대부분이 이 방식이다.</p><br />

<p>왜냐하면 만약 본문내용이 그대로 전달된다 하더라도, 보통 이벤트 페이지가 변경될때 내부 데이터양식도 변경되는경우가 대부분이라 그냥 GET 을 사용하게 된다.</p>

<strong>일시적 리다이렉션</strong>
<br />

- 리소스의 URI가 일시적으로 변경
- 따라서 검색 엔진 등에서 URL 을 변경하면 안됨
- 302 Found
  - 리다이렉트시 요청 메서드가 GET 으로 변하고, 본문이 제거될 수 있음
- 307 Temporary Redirect
  - 리다이렉트시 요청 메서드와 본문 유지(요청 메서드를 변경하면 안된다.)
- 303 See Other
  - 리다이렉트시 요청 메서드가 GET 으로 변경.

### PRG: Post/Redirect/Get

<p>Post로 주문 후(주문하기 버튼) -> 다음 웹 브라우저를 새로고침 -> 우리의 상식선에서는 다시 초기화면으로 돌아가는것이지만, 실제로는 새로고침 이후 다시 Post 가 들어가게 된다.(중복주문)</p><br />

<p>이에 대한 해결.. 예를 들어 /order 로 상품 주문을 요청한다. 주문 데이터베이스에 상품 갯수를 저장한다. 그 다음 200ok 를 통해서 주문 완료를 뛰우게 된다. (즉 현재 상태는 주문완료 창이 띄어져 있는 경우). 이 상태에서 새로고침을 하게 되면 브라우저는 마지막 요청을 다시 요청하게 된다. 여기서 우린 마지막 요청이 주문이었기에, 재주문을 하게 되는 경우가 발생한다. 물론 서버에서 막아야 하지만 클라이언트에서도 막아주면 된다. 이 때 PRG 가 사용된다.</p>

- POST로 주문후에 새로고침으로 인한 중복 주문 방지
- POST로 주문후에 주문 결과 화면을 GET 메서드로 리다이렉트
- 새로고침을 해도 결과화면을 GET으로 조회
- 중복 주문 대신에 결과화면만 계속 보내게 된다.

<p>이렇게 하면 사용성이 좋아지며, 서버에서도 할 일이 줄어들기 떄문에 더욱 좋다. 이제 정리를 해보면..</p>

- 302는 GET으로 변할 수 있다
- 307은 메서드가 변하면 안된다
- 303은 반드시 GET 으로 변해야한다.

<p>기타 리다이렉션 중에서 304 는 캐시에 대해서 설명할 때 추가로 살펴보도록 하자</p>

### 4XX: 클라이언트 오류

<p>먼가 클라이언트가 잘못했다고 하면 400대 코드를 사용하면 된다. 중요한점은 클라이언트가 이미 잘못된 요청이기에 재시도를 얼마나 해도 계속 실패를 하게 된다는 점이다.</p>

- 400 Bad Request : 클라이언트가 잘못된 요청을 해서 서버가 요청을 처리할 수 없음
  - ex) 요청 파라미터가 잘못되거나, API 스펙이 맞지 않을 때.
- 401 Unauthorized : 클라이언트가 해당 리소스에 대한 인증이 필요함(로그인이 안됬다)
  - 인증 : 본인이 누구인지 확인(로그인)
  - 인가 : 권한 등급. 예) 어드민 페이지에 대한 접근 권한
- 403 Forbidden : 서버가 요청을 이해했지만 승인을 거부함
  - 주로 인증 자격 증명은 있지만, 접근 권한이 불충분한 경우
  - 예를 들어 어드민 등급이 아닌 사용자가 로그인을 했지만, 어드민 등급의 리소스에 접근(카페 등급)
- 404 Not Found: 요청 리소스를 찾을 수 없음
  - 요청 리소스가 서버에 없음
  - 또는 클라이언트가 권한이 부족한 리소스에 접근을 할 때 해당 리소스를 숨기고 싶을 때.

### 5XX: 서버 오류

<p>서버 문제라, 재시도할 때 성공할 수도 있다.</p>

- 500 Internal Server Error : 서버 문제로 오류 발생
- 503 Service Unavailable: 서비스 이용 불가
  - 서버가 일시적인 과부하 또는 예정된 작업으로 잠시 요청을 처리할 수 없음
