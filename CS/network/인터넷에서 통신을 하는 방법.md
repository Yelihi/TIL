## 인터넷에서 통신을 하는 방법

### IP

- 우선 인터넷 프로토콜(IP) 에 대해서 알아야 한다.
- 인터넷 프로토콜의 역할은 지정된 IP 주소에 데이터를 전달하고, 패킷(Packet)이라는 통신 단위로 데이터를 전달
- IP 패킷에는 규칙이 있는데, 나의 IP(출발지), 목적지 IP, 전달 메세지 를 패킷에 넣고 전달한다.
- 목적지에서 패킷을 잘 받았다면, 반대로 목적지에서도 확인되었다는 패킷을 만들어서 클라이언트인 나에게 전달한다.
- 다만 한계가 있다. 패킷을 받을 대상이 없거나 서비스가 불능이라도 나는 패킷을 전송하게 된다. 응답이 없을 뿐. 즉, 받을 상태인지를 알 수가 없다.
- 인터넷망에서 전달한 패킷이 사라질수도 있고, 순서대로 도착하지 않을 수도 있다.
- 이런 문제들을 해결해주는 것이 TCP, UDP 이다.

### TCP란

- IP 프로토콜에서 발생하는 문제들을 해결해준다.
- 프로토콜에는 계층이 있다. 보통 OSI 7 Layer 를 들어봤을 것인데, 여기에 집중하지말고 우리가 파악하기 쉽게 해석하자면 크게 어플리케이션, OS, 네트워크 인터페이스로 구별된다 생각하자.
- 어플리케이션 : 우리가 사용하는 인터넷 등 프로그램과 SOCKET 라이브러리
- OS : TCD -> IP
- 네트워크 인터페이스 : LAN 드라이버, LAN 장비

<p>채팅 어플리케이션에서 hello 를 전달한다고 가정해보자</p>

- 어플리케이션에서 hello 메시지를 생성한다
- 이후 SOCKET 라이브러리를 통해 전달한다
- TCP 정보가 생성이되어 TCP 패킷을 통해 메시지를 감싼다
- 이후 IP 패킷이 생성되어 감싼다 (현재 TCP, IP 패킷 포함)
- LAN 카드에 의해 이더넷프레임을 씌어 전달한다.

<p>TCP에는 출발지 PORT, 목적지 PORT, 전송제어, 순서, 검증정보... 등등 포함된다.이러한 TCP 의 특징은 다음과 같다.</p>

- 전송 제어 프로토콜(Transmission Control Protocol)
- 연결 지향: TCP 3 way handshake(가상 연결)
- 데이터 전달 보증
- 순서 보장

### TCP 3 way handwhake

- 우선 클라이언트에서 서버로 syn(싱크로나이즈) 라는 메시지를 보낸다.
- 서버에서는 syn 를 받고 확인한 다음 클라이언트에 ack 를 같이 클라이언트에 보낸다.
- 클라이언트는 ack 를 받고 확인한 뒤 ack 를 서버에 전달한다.
- 이렇게 3번 주고받으면서 클라이언트와 서버가 서로 신뢰할 수 있게 된다.
- 이제 연결이 된걸 확인했으니 그 다음에 데이터를 전송한다.
- 허나 주의할점이 있다. 클라이언트에서 서버까지 가는 과정에 수많은 서버들이 존재하는데, 이 모든 과정에 대한 연결 보장을 이야기하는것이 아니다. 그저 클라이언트와 서버간 연결이 되었구나 하고 생각하자. 즉 물리적 연결은 아니다.

> **데이터 전달 보증**

- 데이터를 전송했다면, 서버에서 데이터를 받았다는 확인 메세지를 전송한다.

> **순서 보장**

- 클라이언트에서 순서대로 패킷을 보내도, 서버에 패킷이 도착했을 때 순서가 잘못되어있다면 서버에서 다시 보내라고 신호를 보낸다.
- 이게 가능한 이유는 TCP 안에는 전송제어 정보, 순서 등등의 정보가 담겨져 있기 때문이다.

### UDP

- 사용자 데이터그램 프로토콜(User Datagram Protocol)
- UDP는 기능이 거의 없다. IP 와 비슷한데 추가된 부분은 PORT 부분이 있다.
- PORT 는 하나의 IP 를 사용하는 클라이언트가 여러가지 어플리케이션을 활용할 때, 각 어플리케이션 마다 서버에서 응답받는 패킷이 오게 될 것이고, 이를 구별하기 위해 사용하게 된다.
- 현재 인터넷 환경 자체는 TCP 가 다 먹고 있으며, 이제 건들수가 없다.
- 이 때 UDP 는 하얀 도화지로 비유가 되곤 하는데, 이 말은 이제 어떠한 새로운 기능이나 커스터마이징이 필요할 떄 UDP 를 사용할 수 있다는 것이고, 앞서서 설명한 TCP 의 3 way 방식등의 절차역시 없기에 속도 자체가 빠르다. 데이터 역시 적게 든다.
- 최근에는 hTTP3 에서 UDP 를 좀 더 활용해보고자 하고 있기에 주목받고 있다.

### PORT

- 우리가 게임도 하면서 화상통화도 하고 웹브라우저도 한다고 한다면, 하나의 클라이언트가 여러개의 서버와 연결을 해야한다.
- 패킷을 보낼때나 받을 때의 경우 이를 어떻게 구별할지에 대한 고민이 생겼다.
- TCP 패킷을 보게 되면 출발지 port 가 있고, 목적지 port 정보가 같이 들어간다.
- 이 port 를 통해서 패킷이 구별이 가능해진다.
- 비유를 하자면 Ip 가 아파트라면 port 는 동 호수라고 생각하자
- 기본적으로 0~65535 번까지 할당이 가능하지만, 0~1023 까지는 잘 알려진 포트라 사용하지 않는것이 좋다.

### DNS

- 우리가 IP 를 사용해서 통신을 할 때, IP를 매번 기억하는경우나, IP 가 중간에 변경되는 경우가 발생하면 문제가 된다.
- 이를 해결하기 위해 도메인(Domain Name System)을 사용할 수 있다.
- 우리가 구글에 접속하는 과정을 생각해보면 도메인이 어떻게 사용되는지 확인할 수 있다.
- www.google.com 을 입력하게 되면 DNS 서버에 전송이 되어 DNS 서버에서는 이 도메인에 맞는 IP 주소를 응답한다.
- IP 주소가 왔으니, 이제 이전 통신과정과 같다.
